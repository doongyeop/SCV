"use client";

import { useEffect, useRef } from "react";

interface CanvasComponentProps {
  data: string; // data JSON 문자열
}

const CanvasComponent: React.FC<CanvasComponentProps> = ({ data }) => {
  const canvasRef = useRef<HTMLCanvasElement>(null);

  useEffect(() => {
    const parsedData: number[][] = JSON.parse(data); // data를 파싱하여 2차원 배열로 처리
    const height = parsedData.length;
    const width = parsedData[0].length;

    const canvas = canvasRef.current;
    if (canvas) {
      canvas.width = width;
      canvas.height = height;

      const ctx = canvas.getContext("2d");
      if (ctx) {
        const imageData = ctx.createImageData(width, height);

        for (let y = 0; y < height; y++) {
          for (let x = 0; x < width; x++) {
            const value = parsedData[y][x];
            const color = Math.floor(((value + 1) / 2) * 255); // -1 ~ 1 범위를 0 ~ 255로 매핑
            const invertedColor = 255 - color; // 흑백 반전

            const index = (y * width + x) * 4; // RGBA 채널
            imageData.data[index] = invertedColor; // Red
            imageData.data[index + 1] = invertedColor; // Green
            imageData.data[index + 2] = invertedColor; // Blue
            imageData.data[index + 3] = 255; // Alpha (불투명)
          }
        }

        ctx.putImageData(imageData, 0, 0);
      }
    }
  }, [data]);

  return <canvas ref={canvasRef}></canvas>;
};

export default CanvasComponent;

// 사용 예시
/* 
import CanvasComponent from "@/components/canvas/CanvasComponent";

export default function workspaceDetail() {
  const data =
    "[[-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.772549033164978, -0.10588234663009644, 0.772549033164978, 1.0, 1.0, 0.3333333730697632, -0.32549017667770386, 0.10588240623474121, -0.5529412031173706, -0.5529412031173706, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.32549017667770386, 1.0, 1.0, 0.5529412031173706, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.772549033164978, -0.772549033164978, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 0.10588240623474121, 1.0, 0.3333333730697632, -0.772549033164978, 0.3333333730697632, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.3333333730697632, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 0.3333333730697632, 1.0, 0.10588240623474121, -1.0, 0.3333333730697632, 1.0, 1.0, -0.10588234663009644, 0.5529412031173706, 1.0, -0.32549017667770386, -0.772549033164978, 0.3333333730697632, 1.0, 1.0, -0.5529412031173706, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.10588234663009644, 1.0, 0.5529412031173706, -1.0, -0.32549017667770386, 1.0, 1.0, -0.5529412031173706, -1.0, 0.10588240623474121, 1.0, -0.10588234663009644, -1.0, -1.0, 1.0, 1.0, 0.10588240623474121, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, -0.772549033164978, -1.0, 0.5529412031173706, 1.0, -0.5529412031173706, -1.0, -1.0, -0.32549017667770386, 1.0, 0.3333333730697632, -1.0, -1.0, 0.5529412031173706, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 0.10588240623474121, 1.0, 0.10588240623474121, -1.0, -0.5529412031173706, 1.0, 0.5529412031173706, -1.0, -1.0, -1.0, -0.32549017667770386, 1.0, -0.32549017667770386, -1.0, -1.0, -0.32549017667770386, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, -0.772549033164978, -1.0, 0.772549033164978, 1.0, -0.32549017667770386, -1.0, -1.0, -1.0, -0.32549017667770386, 1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 0.10588240623474121, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -0.10588234663009644, 1.0, 1.0, -1.0, -1.0, 1.0, 1.0, -0.5529412031173706, -1.0, -1.0, -1.0, -0.32549017667770386, 0.3333333730697632, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, -0.10588234663009644, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, 0.3333333730697632, 1.0, 0.772549033164978, -1.0, -1.0, 0.772549033164978, 1.0, -0.10588234663009644, -1.0, -1.0, -1.0, -0.32549017667770386, -0.772549033164978, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 0.3333333730697632, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 0.3333333730697632, -1.0, -1.0, -0.32549017667770386, 1.0, 0.5529412031173706, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, -0.32549017667770386, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 0.10588240623474121, -1.0, -1.0, -1.0, 0.3333333730697632, 1.0, -0.5529412031173706, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 0.3333333730697632, -1.0, -1.0, -1.0, -1.0, -0.32549017667770386, -0.10588234663009644, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.5529412031173706, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.32549017667770386, 1.0, 0.3333333730697632, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, -0.10588234663009644, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.772549033164978, 1.0, 1.0, -0.772549033164978, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, 0.3333333730697632, 1.0, 1.0, 1.0, -0.772549033164978, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.10588234663009644, 1.0, -0.32549017667770386, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -0.772549033164978, 1.0, 1.0, 1.0, 0.772549033164978, -0.772549033164978, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 0.10588240623474121, 1.0, -0.10588234663009644, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.772549033164978, 1.0, 1.0, 1.0, 1.0, 0.3333333730697632, 0.10588240623474121, -0.32549017667770386, -0.772549033164978, -1.0, -0.32549017667770386, 0.10588240623474121, 0.772549033164978, 1.0, 0.3333333730697632, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.5529412031173706, 0.10588240623474121, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.772549033164978, -0.10588234663009644, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.772549033164978, 0.3333333730697632, 0.3333333730697632, 0.3333333730697632, 1.0, 1.0, 0.3333333730697632, 0.10588240623474121, -0.32549017667770386, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0], [-1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]]";

  return (
    <div className="flex w-full flex-col items-center justify-center gap-10 p-20">
      <div className="flex">Canvas</div>
      <div className="border-2 border-gray-500">
        <CanvasComponent data={data} />
      </div>
    </div>
  );
}

*/
